<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <property name="now" value="now()" dbms="h2"/>
    <property name="now" value="now()" dbms="mysql"/>
    <property name="autoIncrement" value="true"/>

    <changeSet id="20210921-01-1" author="teixbr">
        <createTable tableName="account">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false" />
            </column>
            <column name="fk_accounttype" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="account_type">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="bank">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="currency">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="symbol" type="varchar(10)">
                <constraints nullable="false" />
            </column>
            <column name="abbreviation" type="varchar(10)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="person">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(30)">
                <constraints nullable="false" />
            </column>
            <column name="lastname" type="varchar(30)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="transaction">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="date" type="timestamp">
                <constraints nullable="false" />
            </column>
            <column name="merchant" type="varchar(70)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="varchar(300)">
                <constraints nullable="false" />
            </column>
            <column name="amount" type="double">
                <constraints nullable="false" />
            </column>
            <column name="month" type="int"/>
            <column name="fk_transactiontype" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="fk_transactionmethod" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="fk_currency" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="fk_person" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="fk_account" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="fk_transactionreason" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="transaction_detail">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="fk_transactiondetailtype" type="bigint">
                <constraints nullable="false" />
            </column>
            <column name="fk_transaction" type="bigint">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="transaction_detail_type">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(20)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="transaction_method">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(20)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="transaction_reason">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(300)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <createTable tableName="transaction_type">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(20)">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="20210921-01-2" author="teixbr">
        <addForeignKeyConstraint baseColumnNames="fk_accounttype"
                                 baseTableName="account"
                                 constraintName="fk_accounttype_account"
                                 referencedColumnNames="id"
                                 referencedTableName="account_type"/>
        <addForeignKeyConstraint baseColumnNames="fk_transactiontype"
                                 baseTableName="transaction"
                                 constraintName="fk_transactiontype_transaction"
                                 referencedColumnNames="id"
                                 referencedTableName="transaction_type"/>
        <addForeignKeyConstraint baseColumnNames="fk_transactionmethod"
                                 baseTableName="transaction"
                                 constraintName="fk_transactionmethod_transaction"
                                 referencedColumnNames="id"
                                 referencedTableName="transaction_method"/>
        <addForeignKeyConstraint baseColumnNames="fk_currency"
                                 baseTableName="transaction"
                                 constraintName="fk_currency_transaction"
                                 referencedColumnNames="id"
                                 referencedTableName="currency"/>
        <addForeignKeyConstraint baseColumnNames="fk_person"
                                 baseTableName="transaction"
                                 constraintName="fk_person_transaction"
                                 referencedColumnNames="id"
                                 referencedTableName="person"/>
        <addForeignKeyConstraint baseColumnNames="fk_account"
                                 baseTableName="transaction"
                                 constraintName="fk_account_transaction"
                                 referencedColumnNames="id"
                                 referencedTableName="transaction_type"/>
        <addForeignKeyConstraint baseColumnNames="fk_transactionreason"
                                 baseTableName="transaction"
                                 constraintName="fk_transactionreason_transaction"
                                 referencedColumnNames="id"
                                 referencedTableName="transaction_reason"/>
        <addForeignKeyConstraint baseColumnNames="fk_transactiondetailtype"
                                 baseTableName="transaction_detail"
                                 constraintName="fk_transactiondetailtype_transactiondetail"
                                 referencedColumnNames="id"
                                 referencedTableName="transaction_detail_type"/>
        <addForeignKeyConstraint baseColumnNames="fk_transaction"
                                 baseTableName="transaction_detail"
                                 constraintName="fk_transaction_transactiondetail"
                                 referencedColumnNames="id"
                                 referencedTableName="transaction"/>
    </changeSet>

</databaseChangeLog>
